// =============================================================================
// Metadata - Standard Resource Metadata
// =============================================================================
// This file defines standard metadata types that are used across all resources
// for tracking creation, modification, and lifecycle management.
//
// All resources should include metadata fields for:
// - Audit trail (who created/modified and when)
// - Version control (optimistic locking)
// - Soft delete support
// - Tags and labels
// =============================================================================

syntax = "proto3";

package core.v1;

import "google/protobuf/timestamp.proto";
import "validate/validate.proto";

// Go: Backend services package
option go_package = "github.com/geniustechspace/api-contracts/gen/go/core/v1;corev1";
option java_multiple_files = true;
option java_outer_classname = "MetadataProto";
// Java: Enterprise integration package
option java_package = "com.geniustechspace.api.core.v1";

// =============================================================================
// Resource Metadata
// =============================================================================

// ResourceMetadata contains standard metadata for all resources.
// All persistent entities should include this message.
message ResourceMetadata {
  // Resource version for optimistic locking.
  // Clients should send this value when updating to detect concurrent modifications.
  int64 version = 1 [(validate.rules).int64.gte = 0];

  // Timestamp when the resource was created.
  google.protobuf.Timestamp created_at = 2;

  // User ID of the creator.
  string created_by = 3 [(validate.rules).string.max_len = 64];

  // Timestamp when the resource was last updated.
  google.protobuf.Timestamp updated_at = 4;

  // User ID of the last updater.
  string updated_by = 5 [(validate.rules).string.max_len = 64];

  // Timestamp when the resource was deleted (soft delete).
  // If set, the resource is considered deleted but still exists in storage.
  google.protobuf.Timestamp deleted_at = 6;

  // User ID who deleted the resource.
  string deleted_by = 7 [(validate.rules).string.max_len = 64];

  // Resource ETag for caching and conditional requests.
  string etag = 8 [(validate.rules).string.max_len = 64];

  // Key-value labels for categorization and filtering.
  // Example: {"env": "production", "team": "platform"}
  map<string, string> labels = 10;

  // Free-form tags for flexible categorization.
  // Example: ["critical", "customer-facing", "deprecated"]
  repeated string tags = 11;

  // Resource annotations for additional metadata.
  // Unlike labels, annotations can be longer and are not typically indexed.
  map<string, string> annotations = 12;
}

// =============================================================================
// Change Tracking
// =============================================================================

// ChangeInfo tracks a single change to a resource.
message ChangeInfo {
  // Type of change.
  ChangeType change_type = 1;

  // User who made the change.
  string changed_by = 2 [(validate.rules).string.max_len = 64];

  // Timestamp of the change.
  google.protobuf.Timestamp changed_at = 3;

  // Field path that was changed (e.g., "name", "settings.enabled").
  string field_path = 4;

  // Previous value (JSON-encoded).
  string old_value = 5;

  // New value (JSON-encoded).
  string new_value = 6;

  // Optional reason or comment for the change.
  string reason = 7 [(validate.rules).string.max_len = 512];
}

// ChangeType indicates the type of change made to a resource.
enum ChangeType {
  // Unspecified change type.
  CHANGE_TYPE_UNSPECIFIED = 0;

  // Resource was created.
  CHANGE_TYPE_CREATE = 1;

  // Resource was updated.
  CHANGE_TYPE_UPDATE = 2;

  // Resource was deleted.
  CHANGE_TYPE_DELETE = 3;

  // Resource was restored (undeleted).
  CHANGE_TYPE_RESTORE = 4;

  // Resource was archived.
  CHANGE_TYPE_ARCHIVE = 5;
}
