version: v2

# =============================================================================
# Buf Configuration - Enterprise API Contracts
# =============================================================================
# This configuration enforces enterprise-grade standards for:
# - Code quality and consistency
# - Breaking change detection
# - Package organization
# - Documentation requirements
# =============================================================================

modules:
  - path: proto
    name: buf.build/geniustechspace/api-contracts

# =============================================================================
# Dependencies
# =============================================================================
# External proto dependencies for enterprise features
# Strategy: Use latest stable with no version pin for automatic updates
# Buf always uses semantically versioned releases from BSR
deps:
  # Google APIs - HTTP annotations, field behavior, resource definitions
  # Always use latest stable (Google maintains excellent backward compatibility)
  - buf.build/googleapis/googleapis
  
  # Protobuf validation - Input validation rules
  # Always use latest stable (automatically updated by buf)
  - buf.build/envoyproxy/protoc-gen-validate
  
  # gRPC Gateway - REST/HTTP to gRPC transcoding
  # Always use latest stable (automatically updated by buf)
  - buf.build/grpc-ecosystem/grpc-gateway

# =============================================================================
# Linting Configuration
# =============================================================================
# Strict linting rules to ensure consistency and best practices
lint:
  use:
    # Standard rules
    - STANDARD
    
    # Documentation requirements
    - COMMENTS                                  # All public elements must be documented
    - COMMENT_FIELD                            # All fields require comments
    - COMMENT_ENUM                             # All enums require comments
    - COMMENT_ENUM_VALUE                       # All enum values require comments
    - COMMENT_MESSAGE                          # All messages require comments
    - COMMENT_ONEOF                            # All oneofs require comments
    - COMMENT_RPC                              # All RPCs require comments
    - COMMENT_SERVICE                          # All services require comments
    
    # Naming conventions
    - FILE_LOWER_SNAKE_CASE                    # Files: snake_case.proto
    - PACKAGE_LOWER_SNAKE_CASE                 # Packages: lower.snake.case
    - PACKAGE_DIRECTORY_MATCH                  # Package must match directory
    - PACKAGE_SAME_DIRECTORY                   # One package per directory
    
    # RPC standards
    - RPC_REQUEST_STANDARD_NAME                # Request: {RPC}Request
    - RPC_RESPONSE_STANDARD_NAME               # Response: {RPC}Response
    - RPC_REQUEST_RESPONSE_UNIQUE              # Unique request/response types
    
    # Service standards
    - SERVICE_SUFFIX                           # Services end with "Service"
    
    # Field standards
    - FIELD_LOWER_SNAKE_CASE                   # Fields: snake_case
    - ONEOF_LOWER_SNAKE_CASE                   # Oneofs: snake_case
    
    # Enum standards
    - ENUM_PASCAL_CASE                         # Enums: PascalCase
    - ENUM_VALUE_UPPER_SNAKE_CASE             # Enum values: UPPER_SNAKE_CASE
    - ENUM_ZERO_VALUE_SUFFIX                   # First value ends with _UNSPECIFIED
    - ENUM_NO_ALLOW_ALIAS                      # No enum aliases
    
    # Package versioning
    - PACKAGE_VERSION_SUFFIX                   # Packages end with version (v1, v2)
  
  # Exceptions to standard rules
  except:
    []
  
  # Enum zero value must be {ENUM_NAME}_UNSPECIFIED
  enum_zero_value_suffix: _UNSPECIFIED
  
  # RPC methods cannot use same type for request and response
  rpc_allow_same_request_response: false
  
  # RPC methods cannot use google.protobuf.Empty
  rpc_allow_google_protobuf_empty_requests: false
  rpc_allow_google_protobuf_empty_responses: false
  
  # Service names must end with "Service"
  service_suffix: Service

# =============================================================================
# Breaking Change Detection
# =============================================================================
# Protects API consumers from unexpected breaking changes
breaking:
  use:
    # File-level changes
    - FILE                                      # Track all file changes
    
    # Wire format compatibility (binary)
    - WIRE                                      # Protobuf wire format compatibility
    - WIRE_JSON                                 # JSON wire format compatibility
    
    # Package changes
    - PACKAGE                                   # Package name changes
  
  # Exceptions
  except:
    # Allow certain non-breaking changes
    - FIELD_SAME_DEFAULT                       # Allow default value changes
    - FIELD_SAME_JSON_NAME                     # Allow json_name changes
  
  # Ignore breaking changes in experimental APIs
  ignore:
    - proto/experimental
    - proto/**/experimental
